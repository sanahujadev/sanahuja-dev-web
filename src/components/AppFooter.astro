---
// src/components/AppFooter.astro
import Button from "./ui/Button.astro";
import LinkedIn from "./ui/icons/LinkedIn.astro";
import GitHub from "./ui/icons/Github.astro";
import Star from "./ui/icons/Star.astro";
import ExternalLink from "./ui/icons/ExternalLink.astro";
import type { FooterType } from "../i18n/utils";

// 1. IMPORTAMOS LOS DATOS REALES PARA EL SEO
import localidades from "../i18n/auto/localidades.json";

const { t, lang } = Astro.props as {
  t: FooterType;
  lang: "es" | "en";
};

// --- Configuraci칩n de Slugs para las rutas SEO ---
const designSlugs: Record<string, string> = {
  es: "diseno-web-en",
  en: "web-design-in",
};
const currentDesignSlug = designSlugs[lang];

// --- 1. La "Letra" (Datos) ---
const footerData = {
  brand: {
    tagline: t.brand.tagline,
  },
  localizacion: {
    titulo: t.localizacion.titulo,
    ciudad: t.localizacion.ciudad,
    gmb_link_label: t.localizacion.gmb_link_label,
    gmb_url: t.localizacion.gmb_url,
  },
  navegacion: {
    titulo: t.navegacion.titulo,
    links: [
      {
        label: t.navegacion.links.mantenimiento,
        url: `/${lang}/servicios/mantenimiento-web`,
      },
      {
        label: t.navegacion.links.reputacion,
        url: `/${lang}/servicios/gestion-reputacion-online`,
      },
      { label: t.navegacion.links.blog, url: `/${lang}/blog` },
      {
        label: t.navegacion.links.informe,
        url: `/${lang}/servicios/informe-visibilidad-web`,
      },
      {
        label: t.navegacion.links.bolsa,
        url: `/${lang}/servicios/bolsa-de-horas`,
      },
    ],
  },
  social: {
    titulo: t.social.titulo,
    links: [
      {
        name: "linkedin",
        label: t.social.links.linkedin,
        url: t.social.links.linkedin_url,
      },
      {
        name: "github",
        label: t.social.links.github,
        url: t.social.links.github_url,
      },
      {
        name: "freelancer",
        label: t.social.links.freelancer,
        url: t.social.links.freelancer_url,
      },
    ],
  },
  help: {
    text: t.help.text,
    contact: t.help.contact,
    url: lang === "es" ? `/${lang}/contacto/` : `/${lang}/contact/`,
  },
  legal: [
    {
      label: t.legal.terminos,
      url:
        lang === "es"
          ? "/es/terminos-y-condiciones"
          : "/en/terms-and-conditions",
    },
    {
      label: t.legal.privacidad,
      url: lang === "es" ? "/es/politica-de-privacidad" : "/en/privacy-policy",
    },
    {
      label: t.legal.cookies,
      url: lang === "es" ? "/es/politica-de-cookies" : "/en/cookies-policy",
    },
  ],
  cookieSettings: t.cookieSettings,
  copyright: t.copyright,
};

// --- 2. La L칩gica (Funci칩n de Iconos) ---
const getSocialIcon = (name: string) => {
  switch (name) {
    case "linkedin":
      return LinkedIn;
    case "github":
      return GitHub;
    case "freelancer":
      return Star;
    default:
      return null;
  }
};
---

<footer aria-label="Footer" class="bg-background border-t border-border">
  <div class="max-w-7xl mx-auto px-6 lg:px-8">
    <div class="py-16 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-12 gap-12">
      {/* BRAND & LOCALIZACION */}
      <div class="lg:col-span-4">
        <div class="text-2xl font-bold text-foreground mb-4">
          Sanahuja<span class="text-primary-500">Dev/&gt;</span>
        </div>
        <p class="text-muted-foreground leading-relaxed text-pretty">
          {footerData.brand.tagline}
        </p>

        <div class="mt-8 space-y-2">
          <h3
            class="text-sm font-semibold text-neutral-300 uppercase tracking-wider"
          >
            {footerData.localizacion.titulo}
          </h3>
          <p class="text-muted-foreground text-sm">
            {footerData.localizacion.ciudad}
          </p>
          <a
            href={footerData.localizacion.gmb_url}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-1.5 text-sm text-secondary-400 hover:text-secondary-300 transition-colors group"
          >
            {footerData.localizacion.gmb_link_label}
            <ExternalLink
              class="w-3.5 h-3.5 group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-transform"
            />
          </a>
        </div>
      </div>

      {/* NAVEGACION */}
      <div class="lg:col-span-3">
        <h3
          class="text-sm font-semibold text-neutral-300 uppercase tracking-wider mb-6"
        >
          {footerData.navegacion.titulo}
        </h3>
        <ul class="space-y-3">
          {
            footerData.navegacion.links.map((link) => (
              <li>
                <a
                  href={link.url}
                  class="text-muted-foreground hover:text-foreground transition-colors text-sm"
                >
                  {link.label}
                </a>
              </li>
            ))
          }
        </ul>
      </div>

      {/* SOCIAL */}
      <div class="lg:col-span-2">
        <h3
          class="text-sm font-semibold text-neutral-300 uppercase tracking-wider mb-6"
        >
          {footerData.social.titulo}
        </h3>
        <ul class="space-y-3">
          {
            footerData.social.links.map((link) => {
              const Icon = getSocialIcon(link.name);
              return (
                <li>
                  <a
                    href={link.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="flex items-center gap-3 text-muted-foreground hover:text-foreground transition-colors text-sm group"
                  >
                    <span class="w-5 h-5 flex items-center justify-center text-neutral-400 group-hover:text-secondary-400 transition-colors">
                      {Icon && <Icon class="w-5 h-5" />}

                      {link.name === "freelancer" && (
                        <div class="flex items-center gap-1">
                          <Star class="w-4 h-4" />
                          <span class="text-xs font-semibold">5</span>
                        </div>
                      )}
                    </span>
                    {link.label}
                  </a>
                </li>
              );
            })
          }
        </ul>
      </div>

      {/* CTA BOX */}
      <div class="lg:col-span-3">
        <div
          class="bg-gradient-to-br from-neutral-800 to-neutral-900 border border-border rounded-xl p-6"
        >
          <h3 class="text-lg font-semibold text-foreground mb-3">
            {footerData.help.text}
          </h3>
          <Button
            href={footerData.help.url}
            variant="default"
            class="w-full shadow-lg shadow-primary-500/20"
          >
            {footerData.help.contact}
          </Button>
        </div>
      </div>
    </div>

    {/* ========================================================== */}
    {/* THE SEO TRENCH - ZONA DE COBERTURA DIN츼MICA */}
    {/* ========================================================== */}
    <div class="border-t border-border/50 py-8">
      <div class="flex flex-col gap-4">
        <div class="flex items-center gap-2 mb-2">
            {/* CORRECCI칍N: Usamos text-neutral-200 (casi blanco) para el t칤tulo peque침o */}
            <span class="text-xs font-bold text-neutral-200 uppercase tracking-widest whitespace-nowrap">
            游늸 Zonas de Cobertura {lang === 'es' ? 'Principal' : 'Main Coverage'}:
            </span>
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
            </span>
        </div>
        
        <div class="flex flex-wrap gap-x-3 gap-y-2">
          {localidades.map((loc) => {
             const url = `/${lang}/${currentDesignSlug}/${loc.slug}`;
             const name = loc.name;
             
             return (
                <a 
                  href={url}
                  class="text-[10px] sm:text-xs text-neutral-300 hover:text-primary-400 transition-colors border-b border-transparent hover:border-primary-500/50 pb-0.5"
                  title={`Dise침o web en ${name}`}
                >
                  {name}
                </a>
             );
          })}
        </div>
        
        {/* CORRECCI칍N: Disclaimer en text-neutral-400 (legible pero secundario) */}
        <p class="text-[10px] text-neutral-400 italic mt-1">
            * {lang === 'es' 
                ? 'Prestamos servicio presencial en Tenerife y remoto para todo el mundo.' 
                : 'Providing on-site service in Tenerife and remote service worldwide.'}
        </p>
      </div>
    </div>

    {/* COPYRIGHT & LEGAL */}
    <div class="border-t border-border py-8">
      <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="text-neutral-400 text-sm">
          {footerData.copyright}
          {new Date().getFullYear()}
        </div>

        <div class="flex flex-wrap items-center justify-center gap-6">
          {
            footerData.legal.map((link) => (
              <a
                href={link.url}
                target="_self"
                class="text-neutral-400 text-xs transition-colors hover:text-neutral-300 focus:outline-1 focus:ring-2 focus:ring-primary-500 rounded-sm"
              >
                {link.label}
              </a>
            ))
          }
          <button
            id="cookie-settings-button"
            class="text-neutral-400 hover:text-neutral-300 text-xs transition-colors"
          >
            {footerData.cookieSettings}
          </button>
        </div>
      </div>
    </div>
  </div>
  <script is:inline>
    document.addEventListener('astro:page-load', () => {
      const cookieSettingsButton = document.getElementById('cookie-settings-button');
      if (cookieSettingsButton) {
        cookieSettingsButton.addEventListener('click', (event) => {
          event.preventDefault();
          if (window.__consentManagerInstance) {
            window.__consentManagerInstance.showSettings();
          } else {
            console.warn('ConsentManager instance not found.');
          }
        });
      }
    });
  </script>
</footer>