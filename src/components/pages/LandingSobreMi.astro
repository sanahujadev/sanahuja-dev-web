---
// src/components/pages/LandingAboutMe.astro
import BaseLayout from "../../layouts/BaseLayout.astro";
import Badge from "../../components/ui/Badge.astro";
import Button from "../../components/ui/Button.astro";
import ShieldCheck from "../../components/ui/icons/Shield.astro";
import Star from "../../components/ui/icons/Star.astro";
import Trophy from "../../components/ui/icons/Trophy.astro";
import ArrowRight from "../../components/ui/icons/ArrowRight.astro";
import User from "../../components/ui/icons/User.astro";
import OptimizedLazyImage from "../ui/OptimizedLazyImage.astro";
import TestimonialCard from "../ui/cards/TestimonialCard.astro";
// IMPORTANTE: Asumo que tienes este archivo. Si no, crea un array dummy temporal.
import certifications from "../../data/diplomas.json" with { type: "json" };
import SectionHeader from "../../components/ui/SectionHeader.astro";
import type { SobreMiCopy } from "../../i18n/utils";

interface Props {
  copy: SobreMiCopy;
  alternateUrl: string;
  schema: Record<string, any>;
}

const { copy, alternateUrl, schema } = Astro.props;

const { copy: t, lang, metadata } = copy;
---

<BaseLayout lang={lang as "es" | "en"} alternateUrl={alternateUrl}>
  <script type="application/ld+json" set:html={JSON.stringify(schema)} slot="json-ld" />
  <Fragment slot="head">
    <title>{metadata.title}</title>
    <meta name="description" content={metadata.description} />
  </Fragment>
  <main class="bg-background min-h-screen">
    
    <section id="hero" class="relative pt-32 pb-20 px-4 overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-b from-neutral-900/50 to-transparent pointer-events-none" aria-hidden="true" />
      
      <div class="max-w-6xl mx-auto relative z-10">
        <div class="flex justify-center mb-8">
          <Badge variant="v0_secondary">
            <ShieldCheck class="w-4 h-4 mr-1.5 text-secondary-400" />
            {t.hero.heroVisual.title}
          </Badge>
        </div>

        <div class="text-center mb-12">
          <h1 class="text-5xl md:text-6xl lg:text-7xl font-bold mb-6 text-balance">
            <span class="text-foreground">{t.hero.h1_part1}</span>
            <br />
            <span class="text-primary-500">{t.hero.h1_part2}</span>
          </h1>
          <div class="text-xl md:text-2xl text-muted-foreground max-w-4xl mx-auto leading-relaxed text-balance">
            <p set:html={t.hero.h1_lead} />
          </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto" data-testid="hero-stats">
          {t.hero.heroVisual.stats.map(stat => (
            <div class="bg-neutral-900/50 backdrop-blur-sm border border-border rounded-2xl p-6 text-center" data-stat-label={stat.label}>
              <div class={`text-4xl font-bold mb-2 flex items-center justify-center gap-1 ${stat.color || 'text-foreground'}`}>
                {stat.value}
                {stat.icon === 'Star' && <Star class="w-6 h-6" />}
              </div>
              <div class="text-sm text-muted-foreground">{stat.label}</div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <section id="mi-porque" class="py-20 px-4 bg-neutral-900/30">
      <div class="max-w-4xl mx-auto">
        <SectionHeader
          badgeVariant="v0_primary"
          badgeIcon={User}
          badgeIconClass="text-primary-400"
          badgeText={t.sections.story.badge}
          title={t.sections.story.title}
          titleClass="md:text-5xl mb-12"
          contentClass="leading-relaxed"
        >
          <div class="space-y-6">
            <p set:html={t.sections.story.content_1} />
            <p set:html={t.sections.story.content_2} />
          </div>
        </SectionHeader>
      </div>
    </section>

    <section id="proof" class="py-20 px-4">
      <div class="max-w-5xl mx-auto">
        <SectionHeader
            badgeVariant="v0_accent"
            badgeIcon={Star}
            badgeIconClass="text-accent-400"
            badgeText={t.sections.proof.badge}
            title={t.sections.proof.title}
            content={t.sections.proof.content}
            titleClass="md:text-5xl mb-6"
            contentClass="leading-relaxed !mb-12"
        />

        <div class="bg-gradient-to-br from-accent-500/10 to-secondary-500/10 border border-accent-500/30 rounded-3xl p-8 mb-12" data-proof-card>
          <div class="flex items-center justify-between mb-6 flex-wrap gap-4">
            <div>
              <div class="text-sm font-semibold text-accent-300 mb-1">{t.sections.proof.proofCard.type}</div>
              <div class="text-2xl font-bold text-foreground">{t.sections.proof.proofCard.platform}</div>
            </div>
            <div class="text-right">
              <div class="flex items-center gap-2 mb-1">
                <span class="text-4xl font-bold text-primary-500">{t.sections.proof.proofCard.rating.split(' ')[0]}</span>
                <Star class="w-8 h-8 text-primary-500 fill-current" />
              </div>
              <div class="text-sm text-muted-foreground">{t.sections.proof.proofCard.reviews}</div>
            </div>
          </div>

          <blockquote class="text-lg text-neutral-200 leading-relaxed italic mb-6">
            {t.sections.proof.proofCard.quote}
          </blockquote>

          <a 
            href={t.sections.proof.proofCard.url} 
            target="_blank" 
            rel="nofollow noopener noreferrer"
            class="inline-flex items-center gap-2 text-accent-400 hover:text-accent-300 transition-colors font-semibold group"
          >
            {t.sections.proof.proofCard.cta}
            <ArrowRight class="w-5 h-5 group-hover:translate-x-1 transition-transform" />
          </a>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          {t.sections.proof.reviewsGrid && t.sections.proof.reviewsGrid.map((review) => (
            <TestimonialCard
              name={review.name}
              type={review.type}
              content={review.content}
              img={review.avatarSlug}
              initial={review.initial}
            />
          ))}
        </div>
      </div>
    </section>

    <section id="diplomas" class="py-20 px-4 bg-neutral-900/30" data-diplomas-api="true">
        <div class="max-w-7xl mx-auto">
            <SectionHeader
                badgeVariant="v0_secondary"
                badgeIcon={Trophy}
                badgeIconClass="text-secondary-400"
                badgeText={t.sections.diplomas.badge}
                title={t.sections.diplomas.title}
                content={t.sections.diplomas.content}
                titleClass="md:text-5xl"
                contentClass="!mb-12"
            />

            <div class="flex flex-wrap justify-center gap-3 mb-12" id="diploma-filters">
                {t.sections.diplomas.filterCategories.map((cat, index) => (
                    <Button
                        data-category={cat.id}
                        variant='secondary'
                        class={`px-4 py-2 rounded-full text-sm font-semibold transition-all border ${
                            index === 0 
                            ? 'bg-secondary-600 text-white shadow-lg shadow-secondary-600/25 border-secondary-600' 
                            : 'bg-neutral-900/50 text-muted-foreground hover:text-foreground border-border hover:border-neutral-700'
                        }`}
                    >
                        {cat.label}
                    </Button>
                ))}
            </div>

            <div class="relative group rounded-2xl border border-border bg-neutral-900/20">
                
                <div class="max-h-[680px] overflow-y-auto p-6 custom-scrollbar">
                    <div id="diplomas-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" data-diplomas-grid>
                        {certifications.map((cert) => (
                            <a
                                href={cert.pdfUrl}
                                target="_blank"
                                rel="nofollow noopener noreferrer"
                                data-category={cert.category}
                                class="diploma-card group/card bg-neutral-900/50 border border-border hover:border-secondary-500/50 rounded-2xl overflow-hidden transition-all hover:shadow-xl hover:shadow-secondary-500/10 hover:-translate-y-1 block"
                            >
                                <div class="aspect-[4/3] bg-neutral-800/50 overflow-hidden relative">
                                     <OptimizedLazyImage 
                                        src={cert.thumbnailBaseUrl} 
                                        alt={`Certificado ${cert.title}`}
                                        class="w-full h-full object-cover group-hover/card:scale-105 transition-transform duration-300"
                                     />
                                </div>
                                <div class="p-4">
                                  <h3 class="text-sm font-semibold text-neutral-200 group-hover/card:text-secondary-400 transition-colors line-clamp-2">
                                    {cert.title}
                                  </h3>
                                </div>
                            </a>
                        ))}
                    </div>
                </div>
                
                <div class="absolute bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-background to-transparent pointer-events-none rounded-b-2xl" aria-hidden="true"></div>
            </div>

        </div>
    </section>

    <section id="cta-final" class="py-20 px-4">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-4xl md:text-5xl font-bold mb-6 text-balance text-foreground" set:html={t.sections.ctaFinal.title} />
            <div class="text-xl text-neutral-300 mb-8 leading-relaxed text-balance">
                 <p set:html={t.sections.ctaFinal.content} />
            </div>
            <p class="text-lg text-muted-foreground mb-10" set:html={t.sections.ctaFinal.subtext} />
            
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <Button href={t.ctas.primary.url} variant="primary" size="lg" data-cta="primary" class="group shadow-lg shadow-primary-500/20">
                    {t.ctas.primary.text}
                    <ArrowRight class="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" />
                </Button>
                 <Button href={t.ctas.secondary.url} variant="outline" size="lg">
                    {t.ctas.secondary.text}
                </Button>
            </div>
        </div>
    </section>
  </main>
</BaseLayout>

<script>
  document.addEventListener('astro:page-load', () => {
    const filterButtons = document.querySelectorAll('#diploma-filters button');
    const diplomaCards = document.querySelectorAll('.diploma-card');

    if(filterButtons.length > 0) {
        filterButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                // 1. Update Active State
                filterButtons.forEach(b => {
                    b.classList.remove('bg-secondary-500', 'text-white', 'shadow-lg', 'shadow-secondary-500/25', 'border-secondary-500');
                    b.classList.add('bg-neutral-900/50', 'text-muted-foreground', 'border-border');
                });
                btn.classList.remove('bg-neutral-900/50', 'text-muted-foreground', 'border-border');
                btn.classList.add('bg-secondary-500', 'text-white', 'shadow-lg', 'shadow-secondary-500/25', 'border-secondary-500');

                // 2. Filter Logic
                const category = btn.getAttribute('data-category');
                
                diplomaCards.forEach(card => {
                    const cardCat = card.getAttribute('data-category');
                    // @ts-ignore
                    if (category === 'all' || cardCat === category) {
                        // @ts-ignore
                        card.style.display = 'block';
                        // Optional: Add animation class here
                    } else {
                        // @ts-ignore
                        card.style.display = 'none';
                    }
                });
            });
        });
    }
  });
</script>