---
// src/layouts/BaseLayout.astro
// NOTA: Este es nuestro layout OBJETIVO.
// Los componentes <AppHeader> y <AppFooter> y los scripts se crearán en pasos posteriores.
import { AstroFont } from 'astro-font';
import { ClientRouter } from "astro:transitions";
// import AppFooter from "../components/AppFooter.astro"; // <-- Aún no existe
// import AppHeader from "../components/AppHeader.astro"; // <-- Aún no existe
import "./../styles/global.css"; // <-- Brook creará este
// import type { CookieConsentType } from '../i18n/utils'; // <-- Aún no existe

const { lang = 'es' } = Astro.props;
const GTM_ID = import.meta.env.PUBLIC_GTM_ID;

// ¡LÓGICA DE REFACTOR CORREGIDA!
const siteURL = Astro.site; // <-- ¡Esto SÍ es https://sanahuja.dev!
const pathName = Astro.url.pathname; // <-- Esto SÍ es /es/servicios/diseno-web-tenerife

// ¡Construimos la URL canónica de PRODUCCIÓN!
const canonicalURL = new URL(pathName, siteURL).href;

let alternateUrl = null;
let alternateLang = null;

// (Lógica simple. Si estamos en 'es', la alterna es 'en'. Si no, 'es')
if (lang === 'es') {
  alternateUrl = new URL(pathName.replace('/es/', '/en/'), siteURL).href;
  alternateLang = 'en';
} else if (lang === 'en') {
  alternateUrl = new URL(pathName.replace('/en/', '/es/'), siteURL).href;
  alternateLang = 'es';
}
---

<!DOCTYPE html>
<html lang={lang} class="dark scroll-smooth">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        
        <slot name="head" />

        <link rel="canonical" href={canonicalURL} />
        {alternateUrl && <link rel="alternate" hreflang={alternateLang} href={alternateUrl} />}

        <slot name="json-ld" />

        <ClientRouter />
        <AstroFont
            config={[{
                // 1. La tipografía de nuestra marca (Runbook)
                name: "Montserrat", 
                
                // 2. Pesos que usaremos (Regular, Semibold, Bold, ExtraBold)
                // (Ajustados desde mi propuesta anterior para incluir 500 y 800)
                googleFontsURL: 'https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap',
                
                // 3. Dejamos 'src: []' para que los obtenga de Google
                src: [],
                
                // 4. Optimizaciones
                preload: true,
                display: "swap",
                
                // 5. Aplicación global (¡Correcto!)
                selector: "html",
                fallback: "sans-serif",
            }]}
        />
    </head>
    
    <body class="font-sans bg-neutral-900 text-neutral-200 antialiased">
        <slot />
    </body>
</html>