---
// src/layouts/BaseLayout.astro
import { AstroFont } from 'astro-font';
import { ClientRouter } from "astro:transitions";
import AppHeader from "../components/AppHeader.astro"; // <-- Aún no existe
import "./../styles/global.css"; // <-- Brook creará este
import t_header_es from '../i18n/es/componentes/header.json' with { type: 'json' };
import t_header_en from '../i18n/en/componentes/header.json' with { type: 'json' };
import t_footer_es from '../i18n/es/componentes/footer.json' with { type: 'json' };
import t_footer_en from '../i18n/en/componentes/footer.json' with { type: 'json' };
import AppFooter from '../components/AppFooter.astro';

// import type { CookieConsentType } from '../i18n/utils'; // <-- Aún no existe
const { lang = 'es', alternateUrl } = Astro.props;
const GTM_ID = import.meta.env.PUBLIC_GTM_ID;

// ¡LÓGICA DE REFACTOR CORREGIDA!
const siteURL = Astro.site; // <-- ¡Esto SÍ es https://sanahuja.dev!
const pathName = Astro.url.pathname; // <-- Esto SÍ es /es/servicios/diseno-web-tenerife

// ¡Construimos la URL canónica de PRODUCCIÓN!
const canonicalURL = new URL(pathName, siteURL).href;

const alternateLang = pathName.substring(1, 3) === 'es' ? 'en' : 'es';

const t_header = lang === 'es' ? t_header_es : t_header_en;
const t_footer = lang === 'es' ? t_footer_es : t_footer_en;

console.log("desde baselayout lang", lang);
console.log("desde baselayout el otro lang ", alternateLang);
console.log("desde baselayout pathname", pathName);
console.log("desde baselayout canonical", canonicalURL);
console.log("desde baselayout alternateUrl", alternateUrl);

---

<!DOCTYPE html>
<html lang={lang} class="dark scroll-smooth">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        
        <slot name="head" />

        <link rel="canonical" href={canonicalURL} />
        {alternateUrl && <link rel="alternate" hreflang={alternateLang} href={alternateUrl} />}

        <slot name="json-ld" />

        <ClientRouter />
        <AstroFont
            config={[{
                // 1. La tipografía de nuestra marca (Runbook)
                name: "Montserrat", 
                
                // 2. Pesos que usaremos (Regular, Semibold, Bold, ExtraBold)
                // (Ajustados desde mi propuesta anterior para incluir 500 y 800)
                googleFontsURL: 'https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap',
                
                // 3. Dejamos 'src: []' para que los obtenga de Google
                src: [],
                
                // 4. Optimizaciones
                preload: true,
                display: "swap",
                
                // 5. Aplicación global (¡Correcto!)
                selector: "html",
                fallback: "sans-serif",
            }]}
        />
    </head>
    
    <body class="font-sans bg-neutral-900 text-neutral-200 antialiased">
        <AppHeader t={t_header} lang={lang} alternateUrl={alternateUrl} />
        <slot />
        <AppFooter t={t_footer} lang={lang} />
    </body>
</html>