---
// src/pages/[autoLang]/[designText]/[localidad].astro
import plantillaJson from "../../../i18n/auto/plantilla-ciudades.json" with {
  type: "json",
};
import {
  buildCiudad,
  construirPlantillaDeCiudad,
} from "../../../scripts/utils";
import { getProgrammaticStaticPaths } from "../../../scripts/path-generator";
import type { LocalidadDB, PlantillaCiudad } from "../../../i18n/utils";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Button from "../../../components/ui/Button.astro";
import MapPin from "../../../components/ui/icons/MapPin.astro";
import ArrowRight from "../../../components/ui/icons/ArrowRight.astro";
import AlertTriangle from "../../../components/ui/icons/AlertTriangle.astro";
import CheckCircle2 from "../../../components/ui/icons/CheckCircle2.astro";
import Check from "../../../components/ui/icons/Check.astro";
import OptimizedImage from "../../../components/ui/OptimizedImage.astro";

// --- TUS IMPORTS EXISTENTES ARRIBA ---

export async function getStaticPaths() {
  return await getProgrammaticStaticPaths();
}

const { localidad, lang, alternatePath } = Astro.props;

// Seleccionamos el bloque de idioma correcto
const tpl = plantillaJson[lang as "es" | "en"] as PlantillaCiudad;
const ciudad: Omit<LocalidadDB, "seoDataEn"> = buildCiudad(localidad, lang);
const copy = construirPlantillaDeCiudad(tpl, ciudad);
const alternateUrl = new URL(alternatePath, Astro.site).href;

// Helper para la imagen del mapa (asumiendo que las guardarás como /public/maps/adeje.jpg)
const mapImage = `/maps/${ciudad.slug}.jpg`;
---

<BaseLayout lang={lang as "es" | "en"} alternateUrl={alternateUrl}>
  <script is:inline type="application/ld+json" set:html={JSON.stringify(copy.schema)} slot="json-ld" />
  <Fragment slot="head">
    <title>{copy.metadata.title}</title>
    <meta name="description" content={copy.metadata.description} />
    <meta name="robots" content={copy.metadata.robots} />
  </Fragment>

  <main class="min-h-screen bg-neutral-950">
    
    {/* ============================================== */}
    {/* HERO SECTION */}
    {/* ============================================== */}
    <section id="hero" class="relative px-4 py-24 md:py-32 overflow-hidden">
      {/* Background Pattern */}
      <div class="absolute inset-0 opacity-20 pointer-events-none" aria-hidden="true">
        <div
          class="absolute inset-0"
          style="background-image: radial-gradient(circle at 1px 1px, rgb(100 116 139 / 0.15) 1px, transparent 0); background-size: 40px 40px;"
        ></div>
      </div>

      <div class="relative max-w-7xl mx-auto">
        <div class="grid lg:grid-cols-2 gap-12 items-center">
          {/* Left: Copy */}
          <div>
            {/* Badge Local */}
            <div class="inline-flex items-center gap-2 px-4 py-2 bg-accent-500/10 border border-accent-500/30 rounded-full mb-6">
              <MapPin class="w-4 h-4 text-accent-400" />
              <span class="text-sm font-semibold text-accent-300">Servicio Local en {ciudad.name}</span>
            </div>

            {/* H1 */}
            <h1 class="text-5xl md:text-6xl font-bold mb-6 text-balance text-white">
              {copy.copy.hero.h1_part1}{" "}
              <span class="text-primary-400 block mt-2">{copy.copy.hero.h1_part2}</span>
            </h1>

            {/* Lead */}
            <div class="text-xl text-neutral-300 mb-8 leading-relaxed text-pretty">
               <p set:html={copy.copy.hero.h1_lead} />
            </div>

            {/* CTAs */}
            <div class="flex flex-col sm:flex-row gap-4">
              <Button
                href={copy.copy.hero.ctas.primary.url}
                class="transition-all hover:scale-105"
                variant="primary"
              >
                {copy.copy.hero.ctas.primary.text}
                <ArrowRight class="w-5 h-5" />
              </Button>
              {/* Secondary CTA (Opcional si existe en tu JSON, si no, usa un fallback o borra) */}
              <Button
                href={copy.copy.hero.ctas.secondary.url}
                variant="secondary"
              >
                {copy.copy.hero.ctas.secondary.text}
              </Button>
            </div>
          </div>

          {/* Right: Visual Card */}
          <div class="relative">
            <div class="bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-8 shadow-2xl">
              <div class="text-center mb-6">
                <div class="text-accent-400 font-bold text-sm mb-2">{copy.copy.hero.heroVisual.title}</div>
                <div class="text-white text-2xl font-bold">{copy.copy.hero.heroVisual.subtitle}</div>
              </div>

              <div class="grid grid-cols-3 gap-4">
                <div class="bg-neutral-800/50 border border-neutral-700 rounded-xl p-4 text-center">
                  <div class="text-neutral-400 text-sm mb-1">{copy.copy.hero.heroVisual.stats[0].label}</div>
                  <div class="text-white font-bold text-lg truncate">{copy.copy.hero.heroVisual.stats[0].value}</div>
                </div>
                <div class="bg-neutral-800/50 border border-primary-900/50 rounded-xl p-4 text-center">
                  <div class="text-neutral-400 text-sm mb-1">{copy.copy.hero.heroVisual.stats[1].label}</div>
                  <div class="text-primary-400 font-bold text-lg">{copy.copy.hero.heroVisual.stats[1].value}</div>
                </div>
                <div class="bg-neutral-800/50 border border-neutral-700 rounded-xl p-4 text-center">
                  <div class="text-neutral-400 text-sm mb-1">{copy.copy.hero.heroVisual.stats[2].label}</div>
                  <div class="text-white font-bold text-lg">{copy.copy.hero.heroVisual.stats[2].value}</div>
                </div>
              </div>

              {/* MAP VISUAL PLACEHOLDER */}
              <div class="mt-6 aspect-video bg-neutral-800 rounded-xl border border-neutral-700 overflow-hidden relative group">
                {/* Imagen del mapa (Generada dinámicamente) */}
                <OptimizedImage
                  width={1280}
                  height={720}
                  sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
                  alt={`Mapa de diseño web en ${ciudad.name}`}
                  class="w-full h-full object-cover opacity-50 group-hover:opacity-60 transition-opacity grayscale hover:grayscale-0 duration-500"
                  loading="eager"
                  decoding="async"
                  fetchpriority="high"
                  imageName={ciudad.slug}
                  basePath="sanahujadev/mapas"
                />
                
                {/* Pin Animado */}
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                  <div class="relative">
                    <span class="absolute inline-flex h-full w-full rounded-full bg-primary-400 opacity-75 animate-ping"></span>
                    <div class="relative inline-flex rounded-full h-4 w-4 bg-primary-500 shadow-lg shadow-primary-500/50"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    {/* ============================================== */}
    {/* PAIN POINTS SECTION */}
    {/* ============================================== */}
    <section id="pain-point" class="px-4 py-20 bg-neutral-900/50">
      <div class="max-w-5xl mx-auto">
        <div class="inline-flex items-center gap-2 px-4 py-2 bg-primary-500/10 border border-primary-500/30 rounded-full mb-6">
          <AlertTriangle class="w-5 h-5 text-primary-400" />
          <span class="text-sm font-semibold text-primary-300">{copy.copy.sections.painPoint.badge}</span>
        </div>

        <h2 class="text-4xl md:text-5xl font-bold text-white mb-6 text-balance">
          {copy.copy.sections.painPoint.title}
        </h2>

        <p class="text-xl text-neutral-300 mb-10 leading-relaxed max-w-3xl">
          {copy.copy.sections.painPoint.content}
        </p>

        {/* Quote Card */}
        <div class="bg-gradient-to-br from-neutral-800 to-neutral-900 border-l-4 border-primary-500 rounded-lg p-8 shadow-xl">
          <blockquote class="text-2xl text-neutral-200 font-light mb-4 text-pretty italic" set:html={`"${copy.copy.sections.painPoint.quote}"`}>
          </blockquote>
          <cite class="text-neutral-400 not-italic font-semibold">{copy.copy.sections.painPoint.author}</cite>
        </div>
      </div>
    </section>

    {/* ============================================== */}
    {/* SOLUTION SECTION */}
    {/* ============================================== */}
    <section id="solution" class="px-4 py-20">
      <div class="max-w-6xl mx-auto">
        <div class="text-center mb-12">
          <div class="inline-flex items-center gap-2 px-4 py-2 bg-secondary-500/10 border border-secondary-500/30 rounded-full mb-6">
            <CheckCircle2 class="w-5 h-5 text-secondary-400" />
            <span class="text-sm font-semibold text-secondary-300">{copy.copy.sections.solution.badge}</span>
          </div>

          <h2 class="text-4xl md:text-5xl font-bold text-white mb-6 text-balance">
            {copy.copy.sections.solution.title}
          </h2>

          <p class="text-xl text-neutral-300 max-w-3xl mx-auto leading-relaxed">
            {copy.copy.sections.solution.content}
          </p>
        </div>

        {/* Features Grid */}
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {copy.copy.sections.solution.features.map((f, index) => {
             // Lógica simple para rotar colores de iconos (Primary -> Secondary -> Accent)
             const colors = ["text-primary-400", "text-secondary-400", "text-accent-400"];
             const bgColors = ["bg-primary-500/10", "bg-secondary-500/10", "bg-accent-500/10"];
             const borderColors = ["group-hover:bg-primary-500/20", "group-hover:bg-secondary-500/20", "group-hover:bg-accent-500/20"];
             const color = colors[index % 3];
             const bg = bgColors[index % 3];
             const hoverBg = borderColors[index % 3];

             return (
                <div class="bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-xl p-6 hover:border-neutral-700 transition-all group">
                    <div class={`w-12 h-12 ${bg} rounded-lg flex items-center justify-center mb-4 ${hoverBg} transition-colors`}>
                        {/* Icono Genérico (puedes mapearlos si quieres iconos específicos por feature) */}
                        <Check class={`w-6 h-6 ${color}`} />
                    </div>
                    <h3 class="text-xl font-bold text-white mb-3">{f.title}</h3>
                    <p class="text-neutral-400 leading-relaxed">{f.description}</p>
                </div>
             )
          })}
        </div>
      </div>
    </section>

    {/* ============================================== */}
    {/* CTA FINAL SECTION */}
    {/* ============================================== */}
    <section id="cta-final" class="px-4 py-20 bg-gradient-to-b from-neutral-900 to-neutral-950">
      <div class="max-w-4xl mx-auto text-center">
        <div class="bg-gradient-to-br from-primary-900/20 to-primary-950/20 border border-primary-800/50 rounded-2xl p-12 shadow-2xl relative overflow-hidden">
            {/* Efecto de luz de fondo */}
            <div class="absolute top-0 right-0 -mr-20 -mt-20 w-64 h-64 bg-primary-500/10 blur-3xl rounded-full pointer-events-none"></div>

          <h2 class="text-4xl md:text-5xl font-bold text-white mb-6 text-balance relative z-10">
            {copy.copy.sections.ctaFinal.title}
          </h2>

          <p class="text-xl text-neutral-300 mb-10 leading-relaxed max-w-2xl mx-auto relative z-10">
            {copy.copy.sections.ctaFinal.content}
          </p>

          <div class="flex flex-col sm:flex-row gap-4 justify-center relative z-10">
            <Button
              href={copy.copy.sections.ctaFinal.url}
              class="inline-flex items-center justify-center gap-2 px-8 py-4 bg-primary-700 hover:bg-primary-500 text-white font-semibold rounded-lg transition-all shadow-lg shadow-primary-900/50 hover:shadow-xl hover:shadow-primary-900/70 hover:scale-105"
              variant='primary'
            >
              {copy.copy.sections.ctaFinal.cta}
              <ArrowRight class="w-5 h-5" />
            </Button>
            <Button
              href={copy.copy.sections.ctaFinal.url2}
              class="shadow-lg shadow-primary-500/20"
              variant='outline'
            >
              {copy.copy.sections.ctaFinal.cta2}
            </Button>
          </div>

          {/* Trust Badges */}
          <div class="mt-8 pt-8 border-t border-neutral-800 relative z-10">
            <div class="flex flex-wrap justify-center items-center gap-6 text-neutral-400 text-sm">
              {copy.copy.sections.ctaFinal.trustBadges.map(badge => (
                <div class="flex items-center gap-2">
                  {badge.icon === 'Check' && <Check class="w-5 h-5 text-accent-400" />}
                  {badge.icon === 'MapPin' && <MapPin class="w-5 h-5 text-accent-400" />}
                  <span>{badge.text}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>