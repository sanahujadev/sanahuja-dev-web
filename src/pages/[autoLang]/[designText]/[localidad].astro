---
// src/pages/[autoLang]/[designText]/[localidad].astro
import plantillaJson from "../../../i18n/auto/plantilla-ciudades.json" with {
  type: "json",
};
import {
  buildCiudad,
  construirPlantillaDeCiudad,
} from "../../../scripts/utils";
import { getProgrammaticStaticPaths } from "../../../scripts/path-generator";
import type { LocalidadDB, PlantillaCiudad } from "../../../i18n/utils";
import BaseLayout from "../../../layouts/BaseLayout.astro";

const designSlugs: Record<string, string> = {
  es: "diseno-web-en",
  en: "web-design-in",
};

export async function getStaticPaths() {
  return await getProgrammaticStaticPaths();
}

const { localidad, lang, alternatePath } = Astro.props;

// Seleccionamos el bloque de idioma correcto
const tpl = plantillaJson[lang as "es" | "en"] as PlantillaCiudad;
const ciudad: Omit<LocalidadDB, "seoDataEn"> = buildCiudad(localidad, lang);

const copy = construirPlantillaDeCiudad(tpl, ciudad);

const alternateUrl = new URL(alternatePath, Astro.site).href;
---
<BaseLayout lang={lang as "es" | "en"} alternateUrl={alternateUrl}>
  <script is:inline type="application/ld+json" set:html={JSON.stringify(copy.schema)} slot="json-ld" />
  <Fragment slot="head">
    <title>{copy.metadata.title}</title>
    <meta name="description" content={copy.metadata.description} />
    <meta name="robots" content={copy.metadata.robots} />
  </Fragment>
  <main>
    <section>
      <h1>
        {copy.copy.hero.h1_part1}{" "}
        {copy.copy.hero.h1_part2}
      </h1>
      <p set:html={copy.copy.hero.h1_lead} />
      <a href={copy.copy.hero.ctas.primary.url}>
        {copy.copy.hero.ctas.primary.text}
      </a>
    </section>
    <section>
      <h2>{copy.copy.sections.painPoint.title}</h2>
      <p>{copy.copy.sections.painPoint.content}</p>
      <blockquote>
        {copy.copy.sections.painPoint.quote}
      </blockquote>
    </section>
    <section>
        <h2>{copy.copy.sections.solution.title}</h2>
        <p>{copy.copy.sections.solution.content}</p>
        <ul>
          {copy.copy.sections.solution.features.map((f) => (
            <li>
              <strong>{f.title}</strong><br />
              {f.description}
            </li>
          ))}
        </ul>
      </section>

      <section>
        <h2>{copy.copy.sections.ctaFinal.title}</h2>
        <p>{copy.copy.sections.ctaFinal.content}</p>
        <a href={copy.copy.sections.ctaFinal.url}>
          {copy.copy.sections.ctaFinal.cta}
        </a>
        <a href={copy.copy.sections.ctaFinal.url2}>
          {copy.copy.sections.ctaFinal.cta2}
        </a>
      </section>
  </main>

</BaseLayout>